{% extends 'base.html' %}
{% block extra_code %}
	$(document).ready(function(){
	var socket = io.connect('localhost', {port: 4000});

	socket.io('connect', function(){
		console.log("connected");
	});
	var entry_el = $("#comment");
	socket.on('message', function(message){
	var data = message.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
        
        //Append message to the bottom of the list
        $('#comments').append('<li>' + data + '</li>');
        window.scrollBy(0, 10000000000);
        entry_el.focus();
    });
    entry_el.keypress(function(event){
	 if(event.keyCode != 13) return;
	        var msg = entry_el.attr('value');
	        if(msg){
	           socket.emit('send_message', msg, function(data){
	                console.log(data);
	           });
	        
	        //Clear input value   
	        entry_el.attr('value', '');
	       }
	});
});
{% endblock %}
{% block inner_content %}
<div class="contianer">
	<div class="row">
		<div class="col-lg-12 text-center uk-padding-medium">
			<div class="uk-card uk-card-default uk-margin">
				{% if invalid_request %}
					<h6>You are requested invalid resource</h6>
				{% else %}
					<div class="uk-card uk-card-default uk-width-1-1@m">
					    <div class="uk-card-header">
					        <div class="uk-grid-small uk-flex-middle" uk-grid>
					            <div class="uk-width-auto">
					                <img class="uk-border-circle" width="40" height="40" src="images/avatar.jpg">
					            </div>
					            <div class="uk-width-expand">
					                <h3 class="uk-card-title uk-margin-remove-bottom">{{post.title}}</h3>
					                <p class="uk-text-meta uk-margin-remove-top"><time datetime="2016-04-01T19:00">
					                	{{post.created_at|date}}
					                </time></p>
					            </div>
					        </div>
					    </div>
					    <div class="uk-card-body">
					        <p>{{post.text}}</p>
					    </div>
					    <div class="uk-card-footer">
					       <span>{{post.views}} views</span>
					       <span>{{post.post_likes.count}} likes</span>
					       <span>{{post.post_comments.count}} comments</span>
					       <span>{{post.post_shares.count}} Shares</span>
					    </div>
					    <div class="uk-card-footer">
					    	{% if post_liked %}
					        <a href="{% url 'post_dislike' post.pk %}" class="uk-button uk-button-text">Dislike</a>
					    	{% else %}
					        <a href="{% url 'post_like' post.pk %}" class="uk-button uk-button-text">Like</a>
					    	{% endif %}
					    	<a href="{% url 'post_share' post.pk %}" class="uk-button uk-button-text">Reshare</a>
					    </div>
					</div>
					<hr>
					<div class="uk-form">
						<form method="post">
							{% csrf_token %}
							<div class="uk-margin">
								<textarea name="comment_text" class="uk-textarea" placeholder="comment here"></textarea>
							</div>
							<div class="uk-margin">
								<button type="submit" class="uk-button uk-button-primary" >Comment</button>
							</div>
						</form>
					</div>
					<hr>
					<div class="uk-margin-small-top">
						<ul id="comments">
							{% for comment in post.post_comments.all %}
								<li>{{comment.comment_text}}-{{comment.user.username}}</li>
							{% endfor %}
						</ul>
						<input type="text" name="comment" id="comment">
					</div>
				{% endif %}
			</div>
		</div>
	</div>
</div>
{% endblock %}